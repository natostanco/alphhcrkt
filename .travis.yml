services:
- docker
env:
  global:
    - secure: "dQ3NcCYzhTDvBCSCYMJf9U39L8zEF6MXVRK8Dfo8yQzR1+ZTzVLD9OmrIVk61NNVkXJZrc5hj/P19ONzYjYe18O/UdnroRbO8CCF0TMRWmn3m1/wd99qyDF0Zq2sWxynbZRIFZquAf5QJXUOoUKW/VcW4DdBD5xSxAJvcF90kr8O3VpQHoi1mQkKmw0YpWW7YnFBIiBcW1DstxmSjQSwgOWkMXgfChvaBs1LjpmnEAWu97TqTQDr3pWjfRVGMvZ758vpx7a5rrYPMHI+VoBhVCmowglM7bQtWJiMp4wbsvhzrkb0UYVKeJIX+MqluGOWYcwNYpM/IMFljzkdt8VqTYG2a5Vj3lM4v+nRdgA1QzKKa5Crrgl0kw7ti5ifL5AyP16cG2yDnknCaZPUPpjMiOfhlkGY/IA2rBAkpd+kRoIm5y5zgMyiMSg+hmRrNTn8qYubS6Cit/ou1A1PmxcJB18dNvH2y3fqPDlZT0TClBDP7jEJVJ+RfDIvP1hDebS3E4j5nGiu8QoV37GE+SUecoPuj5SKfmJC+7HFELPaYD768Y6m31TkG1Z3oDOUl1g2ObPBnFWwVtXj9dL+Aw3MarNmIuSS771t7xXcJvai4Izyaul374FpJpu78JJYI56rQrm9JiMh45BovPzSaJRQ1ieKli5fWNwxdy0MClQmLwo="
    - secure: "jLmwXFDMvEiISASjR9r+K2vAER8SyE/OpL7IMFEPSxZfEkGoOwRaFoomsS79Yo3AZpFiWKLZCEADhegmG++TnRjDQ9USvbBC898BSe1c0xP+oYmqzTTBlb6KLfIIgp1ZRGk3KWrz1hflTwA/PyC6+l9Wnba4EKb1P0F2RlrbEmd1EmqCJUBTHFrpE17wmLoEF7R1f5CtnHr/xTBSeM3+yjGXcuMz5A3hVLHN2652rQKomg26qZ5DjzgtxXvzHFO1TuPD3EGFGBMe6r8E2UIknYjt+I2Fds36jVp0TCbQuOe+ULBlmYxA5PmkkkUskRsOeGUAz79XVYfuqETbolGAj1QYGWT7wkCm+C2eiB8qStYfCeEv/tJXmPK064zSyvCIi69RlvSJvQ3BLkoUKpBqowsbckhkSeR38NI/+MMjtEfnhhqDQqHBXwZtjiVg5C7wLaAMWLe0XypN36N92vTIqNKNN5LoGx16JLEyDDqVTrblc1cqBoNniUEQ0bNZOhZ2hijYhcY2Otrg7+ds1mSYvEbzZKU/dzkdInQOLAyAZGnfWlBrMLhc90RJ4KYIiUk7yo4Muw/5bcDO4UDSQSrKFlrbNkNxUOYUbvwKT+zyyIJPvXKdUz1GyFG2SVWHMnrMguV3bUQA0u6XzEbWRvTsehj94IJC7o49Sh84Hk7vm3I="
script:
- export SAVE=$PWD
- docker build -t ubuhphctr .
- sudo ./docker-slim build --continue-after probe --http-probe ubuhphctr
before_deploy:
- cd
- wget `curl -s https://api.github.com/repos/appc/docker2aci/releases | grep browser_download_url
  | head -n 1 | cut -d '"' -f 4` -O d2a.tar.gz
- tar -zxf d2a.tar.gz && rm d2a.tar.gz && d2a=`ls | grep "docker2aci*"` && d2a=`basename
  $d2a` && alias d2a='${PWD}/${d2a}/docker2aci'
- docker save -o ubuhphctr.slim.tar ubuhphctr.slim
- "${PWD}/${d2a}/docker2aci ubuhphctr.slim.tar"
- xz -9 -c ubuhphctr.slim.tar > ubuhphctr.slim.tar.xz
- docker login -u $QUAYL -p $QUAYP quay.io
- docker tag ${cnt}${slim} quay.io/natostanco/$cnt
- docker push quay.io/natostanco/$cnt
deploy:
  provider: releases
  api_key:
    secure: Q0trcCSflN99DkUzYsqKdAXmLJrbSM8YChi4CTiiPX8YbBrKM2ZEeYPYcwBSmqpxLsTLPG+/+Rgo7klP627ysiUFWLq6IZgW0+A6ux+3YA72TV2kpr3NNYwSLXOVpGP63kA7AxiLe6AHOAE6S+1vfgRBfq0aH4fX0YMeLhR43poSaCFPb8OTLURwFx8wzLLdTNW6hdLpSakAhyOUwSABNx2gk1px1/Xx0oMex2WFLppGvtgmaH2hMwjkOj2RF4yPVW865UNI7JYAqgtzKaGJqhSrhREaLzdwxryrjLUoPCturoqrhUQIfweil1X10wmtF/QC0bu18BkDpvzqaTq7O8QaoqMt/0YD2kaTQovcSjNGaadzVSM7uNORXht3IfFJ4CwflemO7JQ0NFOW5fjABSQO8lSasTUfQDkhwCoRWY+uTd+5yQkFDltb+Wu4ltsqFTRndZVS/KNdZrRfmfzYFavr6tejTuJDGHp5Zk4fhsLm2mO5UnqbOmTk7g/BmE8LUbDmP1zC2WfgDK8BaX47c+zc2sfbinFdmd2pff78gVV27dwJ9VMXVGAtaaCF6C5Vzy/b33IonOO+llbN9JqyiwgIOqlI0JS9rMUncI7koHXaeqHqv+V6y3CCNYRU4nX+ReF8t2ILcK1kzd3St32Vjp30e7pzoqpDjvp2xhEXcZI=
  file:
  - ubuhphctr.slim.tar.xz 
  - ubuhphctr.slim-latest.aci 
  skip_cleanup: true
  on:
    tags: true
